# Price Calculator å‡½æ•°å¼æœåŠ¡ - å¿«é€Ÿå¼€å§‹

## ğŸš€ å¿«é€Ÿå¯åŠ¨ï¼ˆ5åˆ†é’Ÿï¼‰

### æ­¥éª¤1ï¼šå¯åŠ¨Eurekaæ³¨å†Œä¸­å¿ƒ
```bash
ä½ç½®ï¼šE:\eureka-server
ä¸»ç±»ï¼šcom.bookstore.eureka.EurekaServerApplication
ç«¯å£ï¼š8761
éªŒè¯ï¼šhttp://localhost:8761
```

### æ­¥éª¤2ï¼šå¯åŠ¨Price Calculator Service
```bash
ä½ç½®ï¼šE:\price-calculator-service
ä¸»ç±»ï¼šcom.bookstore.calculator.PriceCalculatorServiceApplication
ç«¯å£ï¼š8083
```

çœ‹åˆ°è¿™ä¸ªè¾“å‡ºè¡¨ç¤ºæˆåŠŸï¼š
```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘   ğŸ’° Price Calculator Service å¯åŠ¨æˆåŠŸï¼               â•‘
â•‘   ç«¯å£: 8083                                           â•‘
â•‘   ç±»å‹: å‡½æ•°å¼æ— çŠ¶æ€æœåŠ¡                                â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

### æ­¥éª¤3ï¼šæµ‹è¯•API

#### æµ‹è¯•1ï¼šå•é¡¹è®¡ç®—
```bash
curl -X POST http://localhost:8083/api/calculator/item \
  -H "Content-Type: application/json" \
  -d '{"price": 59.99, "quantity": 3}'
```

**é¢„æœŸå“åº”ï¼š**
```json
{
  "price": 59.99,
  "quantity": 3,
  "totalPrice": 179.97,
  "timestamp": 1699000000000,
  "instanceId": "price-calculator-service:8083"
}
```

#### æµ‹è¯•2ï¼šæ‰¹é‡è®¡ç®—ï¼ˆè®¢å•ï¼‰
```bash
curl -X POST http://localhost:8083/api/calculator/batch \
  -H "Content-Type: application/json" \
  -d '{
    "orderId": 12345,
    "items": [
      {"price": 59.99, "quantity": 2},
      {"price": 39.99, "quantity": 1},
      {"price": 29.99, "quantity": 3}
    ]
  }'
```

**é¢„æœŸå“åº”ï¼š**
```json
{
  "orderId": 12345,
  "orderTotal": 249.94,
  "processingTimeMs": 3,
  "instanceId": "price-calculator-service:8083"
}
```

---

## ğŸ§ª éªŒè¯æ— çŠ¶æ€ç‰¹æ€§

**å¤šæ¬¡è°ƒç”¨ç›¸åŒè¾“å…¥ï¼š**

```bash
# ç¬¬1æ¬¡
curl -X POST http://localhost:8083/api/calculator/item \
  -d '{"price": 59.99, "quantity": 3}'
# ç»“æœ: 179.97

# ç¬¬2æ¬¡ï¼ˆç›¸åŒè¾“å…¥ï¼‰
curl -X POST http://localhost:8083/api/calculator/item \
  -d '{"price": 59.99, "quantity": 3}'
# ç»“æœ: 179.97

# ç¬¬3æ¬¡ï¼ˆç›¸åŒè¾“å…¥ï¼‰
curl -X POST http://localhost:8083/api/calculator/item \
  -d '{"price": 59.99, "quantity": 3}'
# ç»“æœ: 179.97
```

**âœ… éªŒè¯ç‚¹ï¼š**
- ç›¸åŒè¾“å…¥å¿…å®šäº§ç”Ÿç›¸åŒè¾“å‡º
- ä¸ä¾èµ–ä¹‹å‰çš„è°ƒç”¨
- å®Œç¾çš„æ— çŠ¶æ€ç‰¹æ€§ï¼

---

## ğŸ“ˆ æµ‹è¯•æ°´å¹³æ‰©å±•

### å¯åŠ¨å¤šä¸ªå®ä¾‹

**æ–¹å¼1ï¼šä¿®æ”¹ç«¯å£å¯åŠ¨ï¼ˆæœ¬åœ°æµ‹è¯•ï¼‰**
```bash
# å®ä¾‹1ï¼ˆé»˜è®¤ç«¯å£8083ï¼‰
cd E:\price-calculator-service
è¿è¡Œä¸»ç±»

# å®ä¾‹2ï¼ˆç«¯å£8084ï¼‰
ä¿®æ”¹application.ymlä¸­çš„server.portä¸º8084
è¿è¡Œä¸»ç±»

# å®ä¾‹3ï¼ˆç«¯å£8085ï¼‰
ä¿®æ”¹application.ymlä¸­çš„server.portä¸º8085
è¿è¡Œä¸»ç±»
```

**æ–¹å¼2ï¼šä½¿ç”¨Mavenå‘½ä»¤**
```bash
# å®ä¾‹1
cd E:\price-calculator-service
mvn spring-boot:run

# å®ä¾‹2ï¼ˆæ–°ç»ˆç«¯ï¼‰
cd E:\price-calculator-service
mvn spring-boot:run -Dspring-boot.run.arguments=--server.port=8084

# å®ä¾‹3ï¼ˆæ–°ç»ˆç«¯ï¼‰
cd E:\price-calculator-service
mvn spring-boot:run -Dspring-boot.run.arguments=--server.port=8085
```

### æŸ¥çœ‹Eurekaæ³¨å†Œ

è®¿é—®ï¼šhttp://localhost:8761

åº”è¯¥çœ‹åˆ°ï¼š
```
PRICE-CALCULATOR-SERVICE (3 instances)
  - price-calculator-service:8083
  - price-calculator-service:8084
  - price-calculator-service:8085
```

### æµ‹è¯•è´Ÿè½½å‡è¡¡

```bash
# é€šè¿‡æœåŠ¡åè°ƒç”¨ï¼ˆè‡ªåŠ¨è´Ÿè½½å‡è¡¡ï¼‰
for i in {1..10}; do
  curl http://localhost:8083/api/calculator/item \
    -d '{"price": 59.99, "quantity": 3}' | jq '.instanceId'
done

# è¾“å‡ºä¼šè½®è¯¢æ˜¾ç¤ºä¸åŒå®ä¾‹ï¼š
# "calculator:8083"
# "calculator:8084"
# "calculator:8085"
# "calculator:8083"
# ...
```

---

## ğŸ”— åœ¨è®¢å•æœåŠ¡ä¸­ä½¿ç”¨

### æ­¥éª¤1ï¼šå¯åŠ¨ä¸»åç«¯æœåŠ¡
```bash
ä½ç½®ï¼šE:\web\online-bookstore-backend
ç«¯å£ï¼š8082
ç¡®ä¿å·²æ·»åŠ PriceCalculatorClient.java
```

### æ­¥éª¤2ï¼šåœ¨OrderServiceä¸­è°ƒç”¨

```java
@Service
public class OrderService {
    @Autowired
    private PriceCalculatorClient calculatorClient;
    
    public Order createOrder(OrderRequest request) {
        // ä½¿ç”¨å‡½æ•°å¼æœåŠ¡è®¡ç®—æ€»ä»·
        var calcRequest = new BatchCalculationRequestDTO(
            null,
            request.getItems().stream()
                .map(item -> new CalculationRequestDTO(
                    item.getPrice(), 
                    item.getQuantity()
                ))
                .toList()
        );
        
        var calcResponse = calculatorClient.calculateBatch(calcRequest);
        BigDecimal orderTotal = calcResponse.orderTotal();
        
        // åˆ›å»ºè®¢å•
        Order order = new Order();
        order.setTotalAmount(orderTotal);
        return orderRepository.save(order);
    }
}
```

---

## ğŸ¯ å®Œæ•´å¯åŠ¨é¡ºåº

```
1ï¸âƒ£ Eureka (8761)           â† æœåŠ¡æ³¨å†Œä¸­å¿ƒ
   â†“
2ï¸âƒ£ Price Calculator (8083)  â† å‡½æ•°å¼æœåŠ¡
   â†“
3ï¸âƒ£ Backend (8082)           â† ä¸»åç«¯ï¼ˆè°ƒç”¨å‡½æ•°æœåŠ¡ï¼‰
   â†“
4ï¸âƒ£ Gateway (8080)           â† APIç½‘å…³ï¼ˆå¯é€‰ï¼‰
   â†“
5ï¸âƒ£ React (3000)             â† å‰ç«¯
```

---

## ğŸ“Š APIæ–‡æ¡£

### POST /api/calculator/item
**è®¡ç®—å•ä¸ªå•†å“é¡¹æ€»ä»·**

**è¯·æ±‚ï¼š**
```json
{
  "price": 59.99,
  "quantity": 3
}
```

**å“åº”ï¼š**
```json
{
  "price": 59.99,
  "quantity": 3,
  "totalPrice": 179.97,
  "timestamp": 1699000000000,
  "instanceId": "price-calculator-service:8083"
}
```

### POST /api/calculator/batch
**æ‰¹é‡è®¡ç®—è®¢å•æ€»ä»·**

**è¯·æ±‚ï¼š**
```json
{
  "orderId": 12345,
  "items": [
    {"price": 59.99, "quantity": 2},
    {"price": 39.99, "quantity": 1}
  ]
}
```

**å“åº”ï¼š**
```json
{
  "orderId": 12345,
  "items": [...],
  "orderTotal": 159.97,
  "processingTimeMs": 3,
  "instanceId": "price-calculator-service:8083"
}
```

### GET /api/calculator/health
**å¥åº·æ£€æŸ¥**

**å“åº”ï¼š**
```json
{
  "status": "UP",
  "service": "price-calculator-service",
  "type": "stateless-function",
  "timestamp": 1699000000000
}
```

---

## â“ å¸¸è§é—®é¢˜

**Q1: ä¸ºä»€ä¹ˆæˆ‘çš„æœåŠ¡åœ¨Eurekaä¸­ä¸æ˜¾ç¤ºï¼Ÿ**
A: æ£€æŸ¥Eurekaåœ°å€é…ç½®ï¼Œç¡®ä¿Eurekaå·²å¯åŠ¨

**Q2: å¦‚ä½•éªŒè¯æœåŠ¡æ˜¯å¦çœŸçš„æ— çŠ¶æ€ï¼Ÿ**
A: å¤šæ¬¡è°ƒç”¨ç›¸åŒè¾“å…¥ï¼Œç»“æœåº”è¯¥å®Œå…¨ä¸€è‡´

**Q3: å¯ä»¥å¯åŠ¨å¤šå°‘ä¸ªå®ä¾‹ï¼Ÿ**
A: ç†è®ºä¸Šæ— é™ï¼å› ä¸ºæ˜¯æ— çŠ¶æ€æœåŠ¡

**Q4: æ€§èƒ½å¦‚ä½•ï¼Ÿ**
A: å•å®ä¾‹å¯å¤„ç†5000+ QPSï¼Œ3ä¸ªå®ä¾‹å¯è¾¾15000+ QPS

---

**æ›´æ–°æ—¶é—´ï¼š** 2025-11-03  
**è¯¦ç»†æ–‡æ¡£ï¼š** è§ã€Šå‡½æ•°å¼æœåŠ¡è¯¦è§£_PriceCalculator.mdã€‹

